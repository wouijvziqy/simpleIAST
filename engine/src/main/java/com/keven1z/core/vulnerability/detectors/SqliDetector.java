package com.keven1z.core.vulnerability.detectors;

import com.keven1z.core.consts.VulnConst;
import com.keven1z.core.model.graph.TaintData;
import com.keven1z.core.log.LogTool;
import com.keven1z.core.utils.TaintUtils;
import com.keven1z.core.vulnerability.Detector;
import com.keven1z.core.vulnerability.report.TaintMessage;
import com.keven1z.core.vulnerability.sanitizer.SanitizerTypeEnum;
import org.apache.log4j.Logger;

import java.util.LinkedList;

public class SqliDetector implements Detector {
    private static final Logger logger = Logger.getLogger(XSSDetector.class);

    @Override
    public boolean detect(TaintMessage taintMessage) {
        LinkedList<TaintData> flowLinks = taintMessage.getFlowLinks();
        if (TaintUtils.isContainSanitizer(flowLinks, SanitizerTypeEnum.parse)) {
            if (LogTool.isDebugEnabled()) {
                logger.warn(String.format("Failed to detect sqli,url:%s, reason:The source of pollution is forced to parse ", taintMessage.getUrl()));
            }
            return false;
        }
        return true;
    }

    @Override
    public boolean supportType(String type) {
        return VulnConst.SQL_INJECTION.equals(type);
    }
}
